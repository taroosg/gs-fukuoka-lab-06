# Like 機能の実装 3（集計と Like 数表示）

## やりたいこと

- ここまでで Like 数を 1 ユーザあたり 1 件に制限する処理を実装した．
- しかし，現状では Like 状況を確認するには phpmyadmin にアクセスして確認するしかなくアプリケーション側に情報が表示されない．
- そこで，本項では Like された件数を todo 一覧画面に表示するための処理を実装する．

## 手順

- Like 情報が保存されている「Like テーブル」を用いて，各 todo が何件 Like されているのかを集計する．
- 「todo テーブル」と「集計結果のテーブル」を結合し，両方のデータを一度に取得できるようにする．
- 取得したデータを画面に表示する．

## 集計

GROUP BY を使うと集計ができる！

### 例（phpmyadmin で実行しよう！）

```sql
SELECT
  todo_id,
  COUNT(id) AS like_count
FROM
  like_table
GROUP BY
  todo_id
```

「`like_table`」の「`todo_id`」ごとに「id の数」を「`like_count`」というカラム名で表示する．

集計したカラムのカラム名は自由に設定できる（しなくても良い）が，後ほど再利用する場合は何らかの名前を指定しておくのがオススメ．

実行すると下記のような集計結果のテーブルが表示される．下記は一例なので，`like_table`のデータによって件数は変化する．

| todo_id | like_count |
| ------: | ---------: |
|       1 |          1 |
|       2 |          1 |
|       4 |          2 |
|       5 |          2 |

### 💡 Key Point

> この SQL 文は「集計結果のテーブル」を出力する！！

### 注意点

- COUNT()で件数を取得しているが，集計関数以外だとエラーになる
- その他の集計関数
  - `MIN()`, `MAX()`, `SUM()`, etc...
